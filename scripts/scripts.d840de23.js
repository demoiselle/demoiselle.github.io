"use strict";var app=angular.module("app",["ngSanitize","ngRoute","mdMarkdownIt","ui.bootstrap","Config"]).config(["$httpProvider",function(a){a.interceptors.push(["$q","$rootScope",function(a,b){return{request:function(c){return b.$broadcast("loading-started"),c||a.when(c)},response:function(c){return b.$broadcast("loading-complete"),c||a.when(c)},responseError:function(c){return b.$broadcast("loading-complete"),a.reject(c)},requestError:function(c){return b.$broadcast("loading-complete"),a.reject(c)}}}]),a.interceptors.push(["$injector",function(a){return a.get("AuthInterceptor")}])}]);app.config(["markdownItConverterProvider",function(a){a.config("commonmark",{breaks:!0,html:!0})}]),app.run(["$rootScope","$location","$window","AlertService","AUTH_EVENTS",function(a,b,c,d,e){a.$on("$routeChangeStart",function(a,b){}),a.$on(e.mensagem,function(a,b){d.notification("Mensagem",b.emit.data)}),a.$on(e.mensagem,function(a,b){d.notification("Comunicado",b.emit.data)}),a.$on(e.quantidade,function(b,c){a.$apply(function(){a.conectados=c.emit.data})}),c.addEventListener("load",function(a){c.applicationCache.addEventListener("updateready",function(a){c.applicationCache.status===c.applicationCache.UPDATEREADY&&(c.location.reload(),alert("Uma nova versão será carregada!"))},!1)},!1)}]),app.constant("APP_EVENTS",{offline:"app-events-offline"}),app.constant("AUTH_EVENTS",{comunicado:"comunicado",mensagem:"mensagem",quantidade:"qtde"}),app.constant("USER_ROLES",{NOT_LOGGED:"NOT_LOGGED"}),app.factory("AuthInterceptor",["$rootScope","$q","AUTH_EVENTS","APP_EVENTS",function(a,b,c,d){return{responseError:function(e){return a.$broadcast({"-1":d.offline,0:d.offline,404:d.offline,503:d.offline,401:c.notAuthenticated,419:c.sessionTimeout,440:c.sessionTimeout}[e.status],e),b.reject(e)}}}]),angular.module("Config",[]).constant("ENV",{name:"production",apiEndpoint:"/"}),app.config(["$routeProvider","USER_ROLES",function(a,b){a.otherwise({redirectTo:"/",data:{authorizedRoles:[b.NOT_LOGGED]}})}]),app.factory("AlertService",["$rootScope","$timeout",function(a,b){var c={};return a.alerts=[],c.addWithTimeout=function(a,d,e){var f=c.add(a,d);b(function(){c.closeAlert(f)},e?e:4e3)},c.add=function(b,c,d){b&&c&&a.alerts.push({type:b,msg:c})},c.showMessageForbiden=function(){this.addWithTimeout("danger","Você não tem permissão para executar essa operação")},c.closeAlert=function(b){return this.closeAlertIdx(a.alerts.indexOf(b))},c.closeAlertIdx=function(b){return a.alerts.splice(b,1)},c.clear=function(){a.alerts=[]},c.notification=function(a){return new Promise(function(b,c){var d=new MessageChannel;d.port1.onmessage=function(a){a.data.error?c(a.data.error):b(a.data)},navigator.serviceWorker.controller.postMessage(a,[d.port2])})},c}]);